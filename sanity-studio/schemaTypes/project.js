import { createRichTextField } from './utils/richTextConfig.js';

export default {
  name: "project",
  title: "üé® Projet",
  type: "document",
  fields: [
    {
      name: "title",
      title: "Titre",
      type: "string",
      validation: (Rule) => Rule.required()
    },

    {
      name: "slug",
      title: "Slug",
      type: "slug",
      options: {
        source: "title",
        maxLength: 96,
      },
      validation: (Rule) => Rule.required()
    },

    {
      name: "description",
      title: "Description courte",
      ...createRichTextField('basic'),
      validation: (Rule) => Rule.max(200).warning("Gardez la description courte pour un meilleur affichage")
    },

    {
      name: "longDescription",
      title: "Description d√©taill√©e",
      ...createRichTextField('medium'),
      description: "Description compl√®te du projet avec tous les d√©tails"
    },

    {
      name: "category",
      title: "Cat√©gorie principale",
      type: "string",
      options: {
        list: [
          { title: "üé® Arts Visuels & Narratifs", value: "arts-visuels-narratifs" },
          { title: "üíª D√©veloppement & Tech", value: "developpement-tech" },
          { title: "üé¨ Vid√©aste", value: "videaste" },
          { title: "üéÆ Game Development", value: "game-development" },
          { title: "üåê Web & Digital", value: "web-digital" }
        ]
      },
      validation: (Rule) => Rule.required(),
      description: "Cat√©gorie principale de ce projet - d√©termine quels tags sont disponibles"
    },

    {
      name: "projectType",
      title: "Type de projet sp√©cifique",
      type: "string",
      options: {
        list: [
          // Arts Visuels & Narratifs
          { title: "üìñ Roman/Livre", value: "roman" },
          { title: "üë§ Character Design", value: "character-design" },
          { title: "‚úèÔ∏è Croquis/Esquisse", value: "croquis" },
          { title: "üé® Illustration", value: "illustration" },
          { title: "üó∫Ô∏è Worldbuilding", value: "worldbuilding" },
          { title: "üìú Lore/Histoire", value: "lore" },
          
          // D√©veloppement & Tech
          { title: "üåê Site Web", value: "website" },
          { title: "üì± Application", value: "application" },
          { title: "üîß API/Backend", value: "api" },
          { title: "üìö Biblioth√®que", value: "library" },
          { title: "üõ†Ô∏è Outil", value: "tool" },
          
          // Vid√©aste
          { title: "üé¨ Vid√©o YouTube", value: "video-youtube" },
          { title: "üé• Court-m√©trage", value: "short-film" },
          { title: "üì∫ Stream", value: "stream" },
          { title: "üéûÔ∏è Montage", value: "editing" },
          
          // Game Development
          { title: "üéÆ Jeu Complet", value: "full-game" },
          { title: "üß© Prototype", value: "prototype" },
          { title: "üé® Assets", value: "game-assets" },
          { title: "üèóÔ∏è Level Design", value: "level-design" },
          
          // Web & Digital
          { title: "üíº Portfolio", value: "portfolio" },
          { title: "üé® UI/UX Design", value: "ui-ux" },
          { title: "üìä Dashboard", value: "dashboard" },
          { title: "üõí E-commerce", value: "ecommerce" }
        ]
      },
      description: "Type sp√©cifique pour une redirection pr√©cise"
    },

    // LIAISONS VERS LES UNIVERS ET PERSONNAGES
    {
      name: "linkedUnivers",
      title: "Univers li√©",
      type: "reference",
      to: [{ type: "univers" }],
      description: "Si ce projet appartient √† un univers narratif sp√©cifique"
    },

    {
      name: "linkedPersonnage",
      title: "Personnage li√©",
      type: "reference", 
      to: [{ type: "personnage" }],
      description: "Si ce projet concerne un personnage sp√©cifique (character design, croquis, etc.)"
    },

    {
      name: "linkedRegion",
      title: "R√©gion li√©e",
      type: "reference",
      to: [{ type: "region" }],
      description: "Si ce projet concerne une r√©gion sp√©cifique (worldbuilding, cartes, etc.)"
    },

    // DESTINATION PERSONNALIS√âE
    {
      name: "customDestination",
      title: "Destination personnalis√©e",
      type: "object",
      fields: [
        {
          name: "destinationType",
          title: "Type de destination",
          type: "string",
          options: {
            list: [
              { title: "üåü Univers Narratif", value: "univers" },
              { title: "üë§ Page Personnage", value: "personnage" },
              { title: "üß™ Labo (Dev/Tech)", value: "labo" },
              { title: "üé¨ Studio (Vid√©o)", value: "studio" },
              { title: "üé® Atelier (Art)", value: "atelier" },
              { title: "üìä Page Projets", value: "projets" },
              { title: "üîó URL Externe", value: "external" }
            ]
          }
        },
        {
          name: "specificSection",
          title: "Section sp√©cifique",
          type: "string",
          description: "Ex: 'personnages', 'regions', 'dev/portfolio-web', etc.",
          hidden: ({ parent }) => parent?.destinationType === 'external'
        },
        {
          name: "externalUrl",
          title: "URL externe",
          type: "url",
          hidden: ({ parent }) => parent?.destinationType !== 'external'
        }
      ],
      description: "D√©finir manuellement o√π ce projet doit rediriger quand on clique dessus"
    },

    {
      name: "tags",
      title: "Tags de qualification",
      type: "array",
      of: [{ 
        type: "reference", 
        to: [{ type: "tag" }],
        options: {
          filter: ({ document }) => {
            if (!document?.category) {
              return {};
            }
            return {
              filter: 'category == $category',
              params: { category: document.category }
            }
          }
        }
      }],
      description: "Tags pour qualifier ce projet - Filtr√©s selon la cat√©gorie choisie"
    },

    {
      name: "image",
      title: "Image principale",
      type: "image",
      options: {
        hotspot: true,
      },
      validation: (Rule) => Rule.required(),
      description: "Image de pr√©sentation principale du projet"
    },

    {
      name: "images",
      title: "Images additionnelles",
      type: "array",
      of: [{ 
        type: "image",
        options: {
          hotspot: true,
        },
        fields: [
          {
            name: "caption",
            title: "L√©gende",
            type: "string"
          },
          {
            name: "imageType",
            title: "Type d'image",
            type: "string",
            options: {
              list: [
                { title: "üì∏ Image finale", value: "final" },
                { title: "‚úèÔ∏è Croquis", value: "sketch" },
                { title: "üé® Work in Progress", value: "wip" },
                { title: "üìù Concept Art", value: "concept" },
                { title: "üñºÔ∏è R√©f√©rence", value: "reference" }
              ]
            }
          }
        ]
      }],
      description: "Galerie d'images suppl√©mentaires (croquis, WIP, concepts, etc.)"
    },

    {
      name: "projectUrl",
      title: "URL du projet",
      type: "url",
      description: "Lien vers le projet en ligne (site web, application, etc.)"
    },

    {
      name: "githubUrl",
      title: "URL GitHub",
      type: "url",
      description: "Lien vers le d√©p√¥t GitHub du projet"
    },

    {
      name: "youtubeUrl",
      title: "URL YouTube",
      type: "url",
      description: "Lien vers une vid√©o YouTube li√©e au projet"
    },

    {
      name: "technologies",
      title: "Technologies utilis√©es",
      type: "array",
      of: [{ type: "string" }],
      options: {
        layout: "tags"
      },
      description: "Liste des technologies, frameworks, outils utilis√©s"
    },

    {
      name: "status",
      title: "Statut du projet",
      type: "string",
      options: {
        list: [
          { title: "üöß En cours", value: "in-progress" },
          { title: "‚úÖ Termin√©", value: "completed" },
          { title: "‚è∏Ô∏è En pause", value: "paused" },
          { title: "üí° Concept", value: "concept" },
          { title: "üéØ Planifi√©", value: "planned" }
        ]
      },
      initialValue: "in-progress"
    },

    {
      name: "startDate",
      title: "Date de d√©but",
      type: "date",
      description: "Date de d√©but du projet"
    },

    {
      name: "endDate",
      title: "Date de fin",
      type: "date",
      description: "Date de fin du projet (si termin√©)"
    },

    {
      name: "featured",
      title: "Projet mis en avant",
      type: "boolean",
      initialValue: false,
      description: "Afficher ce projet en priorit√© sur la page d'accueil"
    },

    {
      name: "isPublished",
      title: "üìñ Publi√©",
      type: "boolean",
      initialValue: true,
      description: "Contr√¥le si ce projet est visible sur le site (d√©cochez pour masquer compl√®tement)"
    },

    {
      name: "showInGallery",
      title: "Afficher dans la galerie d'accueil",
      type: "boolean",
      initialValue: true,
      description: "Afficher ce projet dans la galerie d√©filante de la page d'accueil"
    },

    {
      name: "priority",
      title: "Priorit√© d'affichage",
      type: "number",
      validation: (Rule) => Rule.min(1).max(10),
      initialValue: 5,
      description: "Priorit√© pour l'ordre d'affichage (1 = plus important, 10 = moins important)"
    }
  ],

  preview: {
    select: {
      title: "title",
      category: "category",
      projectType: "projectType",
      linkedUnivers: "linkedUnivers.nom",
      linkedPersonnage: "linkedPersonnage.nom",
      status: "status",
      featured: "featured",
      isPublished: "isPublished",
      media: "image"
    },
    prepare(selection) {
      const { title, category, projectType, linkedUnivers, linkedPersonnage, status, featured, isPublished, media } = selection;
      
      // Formater la cat√©gorie
      const categoryEmojis = {
        'arts-visuels-narratifs': 'üé®',
        'developpement-tech': 'üíª',
        'videaste': 'üé¨',
        'game-development': 'üéÆ',
        'web-digital': 'üåê'
      };
      
      const statusEmojis = {
        'in-progress': 'üöß',
        'completed': '‚úÖ',
        'paused': '‚è∏Ô∏è',
        'concept': 'üí°',
        'planned': 'üéØ'
      };
      
      const categoryEmoji = categoryEmojis[category] || 'üìÅ';
      const statusEmoji = statusEmojis[status] || '';
      const featuredEmoji = featured ? '‚≠ê ' : '';
      const publishedEmoji = isPublished === false ? 'üëÅÔ∏è ' : '';
      
      // Construire le sous-titre avec les liaisons
      let subtitle = `${categoryEmoji} ${category || 'Sans cat√©gorie'}`;
      if (projectType) {
        subtitle += ` ‚Ä¢ ${projectType}`;
      }
      if (linkedUnivers) {
        subtitle += ` ‚Ä¢ üåü ${linkedUnivers}`;
      }
      if (linkedPersonnage) {
        subtitle += ` ‚Ä¢ üë§ ${linkedPersonnage}`;
      }
      subtitle += ` ${statusEmoji}`;
      
      // Ajouter l'√©tat de publication
      if (isPublished === false) {
        subtitle += ' ‚Ä¢ üö´ NON PUBLI√â';
      }
      
      return {
        title: `${publishedEmoji}${featuredEmoji}${title || "Sans titre"}`,
        subtitle: subtitle,
        media: media
      };
    }
  },

  orderings: [
    {
      title: 'Priorit√©',
      name: 'priorityDesc',
      by: [
        {field: 'priority', direction: 'asc'},
        {field: 'featured', direction: 'desc'},
        {field: '_createdAt', direction: 'desc'}
      ]
    },
    {
      title: 'Par univers',
      name: 'universAsc',
      by: [
        {field: 'linkedUnivers.nom', direction: 'asc'},
        {field: 'priority', direction: 'asc'}
      ]
    },
    {
      title: 'Par type de projet',
      name: 'typeAsc',
      by: [
        {field: 'projectType', direction: 'asc'},
        {field: 'priority', direction: 'asc'}
      ]
    },
    {
      title: 'Date de cr√©ation',
      name: 'createdAtDesc',
      by: [
        {field: '_createdAt', direction: 'desc'}
      ]
    }
  ]
}; 