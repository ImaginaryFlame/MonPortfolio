import { visibilityFields, enrichPreviewWithVisibility, visibilityOrderings } from './utils/visibilityHelper.js';
import { createRichTextField } from './utils/richTextConfig.js';

export default {
  name: 'celebrations',
  title: 'üéâ C√©l√©bration',
  type: 'document',
  fields: [
    {
      name: 'nom',
      type: 'string',
      title: 'Nom',
      validation: Rule => Rule.required()
    },
    {
      name: 'univers',
      type: 'reference',
      title: 'üåç Univers d\'origine',
      to: [{ type: 'univers' }],
      validation: Rule => Rule.required()
    },
    {
      name: 'type',
      type: 'string',
      title: 'Type de c√©l√©bration',
      options: {
        list: [
          { title: 'üéä Festival', value: 'festival' },
          { title: 'üèõÔ∏è C√©r√©monie', value: 'ceremonie' },
          { title: '‚öîÔ∏è Rituel', value: 'rituel' },
          { title: 'üé≠ Carnaval', value: 'carnaval' },
          { title: 'üôè F√™te religieuse', value: 'fete_religieuse' },
          { title: 'üëë Comm√©moration', value: 'commemoration' },
          { title: 'üå± F√™te saisonni√®re', value: 'fete_saisonniere' },
          { title: 'üé™ Foire', value: 'foire' }
        ]
      }
    },
    {
      name: 'resume',
      title: 'R√©sum√©',
      description: 'Br√®ve description de la c√©l√©bration',
      ...createRichTextField('basic')
    },
    {
      name: 'histoire',
      title: 'Histoire',
      description: 'Histoire et origines de la c√©l√©bration',
      ...createRichTextField('medium')
    },
    {
      name: 'deroulement',
      type: 'object',
      title: 'üìÖ D√©roulement',
      fields: [
        {
          name: 'frequence',
          type: 'string',
          title: 'Fr√©quence',
          options: {
            list: [
              { title: 'üìÜ Annuelle', value: 'annuelle' },
              { title: 'üåô Mensuelle', value: 'mensuelle' },
              { title: 'üåû Saisonni√®re', value: 'saisonniere' },
              { title: '‚≠ê Exceptionnelle', value: 'exceptionnelle' },
              { title: 'üîÑ Cyclique', value: 'cyclique' }
            ]
          }
        },
        {
          name: 'duree',
          type: 'object',
          title: 'Dur√©e',
          fields: [
            {
              name: 'nombre',
              type: 'number',
              title: 'Nombre'
            },
            {
              name: 'unite',
              type: 'string',
              title: 'Unit√©',
              options: {
                list: [
                  { title: '‚è∞ Heures', value: 'heures' },
                  { title: 'üìÖ Jours', value: 'jours' },
                  { title: 'üìÖ Semaines', value: 'semaines' },
                  { title: 'üåô Mois', value: 'mois' }
                ]
              }
            }
          ]
        },
        {
          name: 'etapes',
          type: 'array',
          title: '√âtapes',
          of: [{
            type: 'object',
            fields: [
              {
                name: 'nom',
                type: 'string',
                title: 'Nom de l\'√©tape'
              },
              {
                name: 'description',
                title: 'Description',
                ...createRichTextField('basic')
              },
              {
                name: 'importance',
                type: 'string',
                title: 'Importance',
                options: {
                  list: [
                    { title: '‚≠ê Cruciale', value: 'cruciale' },
                    { title: 'üåü Majeure', value: 'majeure' },
                    { title: '‚ú® Mineure', value: 'mineure' }
                  ]
                }
              }
            ]
          }]
        }
      ]
    },
    {
      name: 'participants',
      type: 'object',
      title: 'üë• Participants',
      fields: [
        {
          name: 'organisateurs',
          type: 'array',
          title: 'Organisateurs',
          of: [{
            type: 'reference',
            to: [{ type: 'faction' }]
          }]
        },
        {
          name: 'roles',
          type: 'array',
          title: 'R√¥les sp√©cifiques',
          of: [{
            type: 'object',
            fields: [
              {
                name: 'titre',
                type: 'string',
                title: 'Titre du r√¥le'
              },
              {
                name: 'description',
                title: 'Description',
                ...createRichTextField('basic')
              },
              {
                name: 'conditions',
                title: 'Conditions d\'acc√®s',
                ...createRichTextField('basic')
              }
            ]
          }]
        },
        {
          name: 'restrictions',
          type: 'array',
          title: 'Restrictions de participation',
          of: [{
            type: 'object',
            fields: [
              {
                name: 'type',
                type: 'string',
                title: 'Type de restriction',
                options: {
                  list: [
                    { title: 'üë• Sociale', value: 'sociale' },
                    { title: 'üè∞ G√©ographique', value: 'geographique' },
                    { title: '‚ú® Magique', value: 'magique' },
                    { title: '‚öîÔ∏è Martiale', value: 'martiale' },
                    { title: 'üé≠ Culturelle', value: 'culturelle' }
                  ]
                }
              },
              {
                name: 'description',
                title: 'Description',
                ...createRichTextField('basic')
              }
            ]
          }]
        }
      ]
    },
    {
      name: 'elements',
      type: 'object',
      title: 'üé≠ √âl√©ments de c√©l√©bration',
      fields: [
        {
          name: 'rituels',
          type: 'array',
          title: 'Rituels',
          of: [{
            type: 'object',
            fields: [
              {
                name: 'nom',
                type: 'string',
                title: 'Nom du rituel'
              },
              {
                name: 'description',
                title: 'Description',
                ...createRichTextField('basic')
              },
              {
                name: 'symbolisme',
                title: 'Symbolisme',
                ...createRichTextField('basic')
              }
            ]
          }]
        },
        {
          name: 'objets',
          type: 'array',
          title: 'Objets rituels',
          of: [{
            type: 'reference',
            to: [{ type: 'objet' }]
          }]
        },
        {
          name: 'musiques',
          type: 'array',
          title: 'Musiques et chants',
          of: [{
            type: 'object',
            fields: [
              {
                name: 'nom',
                type: 'string',
                title: 'Nom'
              },
              {
                name: 'description',
                title: 'Description',
                ...createRichTextField('basic')
              },
              {
                name: 'paroles',
                type: 'text',
                title: 'Paroles',
                rows: 5
              }
            ]
          }]
        },
        {
          name: 'costumes',
          type: 'array',
          title: 'Costumes et tenues',
          of: [{
            type: 'object',
            fields: [
              {
                name: 'nom',
                type: 'string',
                title: 'Nom'
              },
              {
                name: 'description',
                title: 'Description',
                ...createRichTextField('basic')
              },
              {
                name: 'symbolisme',
                title: 'Symbolisme',
                ...createRichTextField('basic')
              }
            ]
          }]
        }
      ]
    },
    {
      name: 'signification',
      type: 'object',
      title: 'üí´ Signification',
      fields: [
        {
          name: 'symbolisme',
          title: 'Symbolisme',
          description: 'Signification symbolique de la c√©l√©bration',
          ...createRichTextField('basic')
        },
        {
          name: 'valeurs',
          type: 'array',
          title: 'Valeurs c√©l√©br√©es',
          of: [{
            type: 'string',
            options: {
              list: [
                { title: '‚öîÔ∏è Honneur', value: 'honneur' },
                { title: 'ü§ù Unit√©', value: 'unite' },
                { title: '‚ú® Spiritualit√©', value: 'spiritualite' },
                { title: 'üå± Nature', value: 'nature' },
                { title: 'üí™ Force', value: 'force' },
                { title: 'üé® Art', value: 'art' },
                { title: '‚ù§Ô∏è Amour', value: 'amour' },
                { title: 'üåü Espoir', value: 'espoir' },
                { title: 'üìö Savoir', value: 'savoir' },
                { title: '‚öñÔ∏è Justice', value: 'justice' }
              ]
            }
          }]
        },
        {
          name: 'impact',
          type: 'array',
          title: 'Impact social',
          of: [{
            type: 'string',
            options: {
              list: [
                { title: 'ü§ù Coh√©sion sociale', value: 'cohesion' },
                { title: 'üé≠ Expression culturelle', value: 'expression' },
                { title: '‚ú® Renouveau spirituel', value: 'renouveau' },
                { title: 'üí´ Transmission', value: 'transmission' },
                { title: '‚öñÔ∏è R√©gulation sociale', value: 'regulation' }
              ]
            }
          }]
        }
      ]
    },
    {
      name: 'image',
      type: 'image',
      title: 'üñºÔ∏è Image repr√©sentative',
      options: {
        hotspot: true
      }
    },

    // Champs de visibilit√©
    ...visibilityFields
  ],
  preview: {
    select: {
      title: 'nom',
      subtitle: 'type',
      media: 'image',
      featured: 'featured',
      isPublished: 'isPublished'
    },
    prepare(selection) {
      const { title, subtitle, media, featured, isPublished } = selection;
      
      const featuredEmoji = featured ? '‚≠ê ' : '';
      const publishedEmoji = isPublished === false ? 'üëÅÔ∏è ' : '';
      
      return {
        title: `${publishedEmoji}${featuredEmoji}${title || 'Sans nom'}`,
        subtitle: (subtitle || '') + (isPublished === false ? ' ‚Ä¢ üö´ NON PUBLI√â' : ''),
        media: media
      };
    }
  },
  orderings: [
    ...visibilityOrderings,
    {
      title: 'Nom A-Z',
      name: 'nomAsc',
      by: [{ field: 'nom', direction: 'asc' }]
    },
    {
      title: 'Par type',
      name: 'typeAsc',
      by: [
        { field: 'type', direction: 'asc' },
        { field: 'nom', direction: 'asc' }
      ]
    }
  ]
}